<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- CSRF token, if your plugin need to make POST request to backend -->
    <meta name="zoraxy.csrf.Token" content="{{.csrfToken}}">
    <link rel="stylesheet" href="/script/semantic/semantic.min.css">
    <script src="/script/jquery-3.6.0.min.js"></script>
    <script src="/script/semantic/semantic.min.js"></script>
    <script src="/script/utils.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/main.css">
    <title>Fail2Ban</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            background:none;
        }
    </style>
</head>
<body>
    <!-- Dark theme script must be included after body tag-->
    <link rel="stylesheet" href="/darktheme.css">
    <script src="/script/darktheme.js"></script>
    <div style="display:flex;flex-direction:column;width:80%">
        <div style="display:flex;flex-direction:column;text-align: center;">
            <h1>Fail2Ban Plugin</h1>
            <p>Welcome to the Fail2Ban plugin.</p>
            <p>Here you can see current IPs banned by Fail2ban as well as reconfigure fail2ban itself.</p>
            <button class="ui button primary" id="sendRequestButton">Send Request</button>
        </div>
        <div style="display:flex;flex-direction:column;text-align: center;">
            <h2>Config</h2>
            <p>Here you can change the filter configuration for reading the Zoraxy logs.</p>
            <textarea id="filterconfig" style="width:100%;height:150px"></textarea>
            <button class="ui button primary" id="updateFilterConfigRequestButton">Update</button>
        </div>
    </div>
	
	<script>
		document.getElementById('sendRequestButton').addEventListener('click', function() {
			$.ajax({
				url: `./api/getstatus`,
				type: 'GET',
				success: function(data) {
					console.log('Response:', data.message);
				},
				error: function(xhr, status, error) {
					console.error('Error:', error);
				}
			});
		});

		document.getElementById('updateFilterConfigRequestButton').addEventListener('click', function() {
			$.cjax({
				url: `./api/filter`,
				type: 'POST',
                contentType: 'text/html',
                data: document.getElementById('filterconfig').value,
				success: function(data) {
					console.log('Response:', data.message);
				},
				error: function(xhr, status, error) {
					console.error('Error:', error);
				}
			});
		});        

        $.ajax({
            url: './api/filter',
            type: 'GET',
            success: function(data) {
                document.getElementById('filterconfig').value = data;
            },
            error: function(xhr, status, error) {
                document.getElementById('filterconfig').value = "Error getting filter config!";
            }
        })
	</script>
</body>
</html>